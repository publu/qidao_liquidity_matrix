<div id="<%= dom_id network %>">
  <table class="table table-striped">
    <div class="float-end">
      <%= link_to "Edit this chain", edit_network_path(@network), class: "btn btn-outline-primary btn-sm" %> &nbsp;
      <%= link_to "Destroy this chain", @network, method: :delete, class: "btn btn-outline-danger btn-sm" %> &nbsp;
      <%= link_to tokens_path, class: "btn-nav", title: "Go home" do %><ion-icon name="home-outline"></ion-icon><% end %>
      <a href="https://github.com/spicy-muaddib/qidao_liquidity_matrix" target="_blank" title="Github" class="btn-nav"><ion-icon name="logo-github"></ion-icon></a>
    </div>
    <tr class="table-header">
      <th class="red">Chain</th>
      <th class="red">
        <%= sort_network_link(column: "symbol", label: "Asset") %>
        <%= sort_indicator if params[:column] == "symbol" %>
      </th>
      <th class="red text-end">
        <%= sort_network_link(column: "liquidity", label: "Total onchain liquidity") %>
        <%= sort_indicator if params[:column] == "liquidity" %>
      </th>
      <th width="15%" class="red text-end">
        <%= sort_network_link(column: "trade_slippage", label: "Largest trade for stable with < 10% slippage") %>
        <%= sort_indicator if params[:column] == "trade_slippage" %>
      </th>
      <th class="red text-end">
        <%= sort_network_link(column: "volume", label: "1M Average Daily Volume") %>
        <%= sort_indicator if params[:column] == "volume" %>
      </th>
      <th width="15%" class="red text-end">
        <%= sort_network_link(column: "centralized", label: "Does one wallet own more than 20% of tokens in onchain LPs?") %>
        <%= sort_indicator if params[:column] == "centralized" %>
      </th>
      <th class="red text-center"><%= link_to "Risk grading", network_path %></th>
      <th class="red text-end">Last updated</th>
    </tr>
    <% @tokens.each do |token| %>
    <tr>
      <td style="color: <%= token.network.color %>">
        <%= token.network.name %>
      </td>
      <td>
        <strong>
          <%= link_to token.symbol, token, title: "View rubric for " + token.symbol + " on " + token.network.name, class: "plain_link" %>
        </strong>
      </td>
      <td class="text-end">
        <%= number_to_currency(token.liquidity) %>
      </td>
      <td class="text-end">
        <%= number_to_currency(token.trade_slippage) %>
      </td>
      <td class="text-end">
        <%= number_to_currency(token.volume) %>
      </td>
      <td class="text-center">
        <% if token.centralized? %>
          <span class="text-danger">Yes</span>
        <% else %>
          No
        <% end %>
      </td>
      <td class="text-center">
        <%= link_to token, title: "View rubric for " + token.symbol + " on " + token.network.name do %><strong><%= token.grade %><% end %>
      </td>
      <td class="text-end">
        <%= token.updated_at.strftime("%d %B, %Y") %>
      </td>
    </tr>
    <% end %>
    <tr>
      <td><strong>Totals</strong></td>
      <td><strong><%= network.tokens.count %></strong></td>
      <td class="text-end"><strong><%= number_to_currency(network.tokens.sum(:liquidity)) %></strong></td>
      <td class="text-end"><strong><%= number_to_currency(network.tokens.sum(:trade_slippage) / network.tokens.count) %> (Avg)</strong></td>
      <td class="text-end"><strong><%= number_to_currency(network.tokens.sum(:volume)) %></strong></td>
      <td class="text-center"><strong><%= network.tokens.where(centralized: true).count %></strong></td>
      <td class="text-center">
        <% sum = 0 %>
        <% @tokens.each do |t| %>
            <% product = (grade_to_number(t.grade)).to_i %>
            <% sum += product %>
            <% product %>
        <% end %>
        <strong><%= num_to_grade(sum / network.tokens.count) %> (Avg)</strong>
      </td>
      <td class="text-end">-</td>
    </tr>
  </table>
  <% if @token_count > 15 %>
    <div class="footer"><%== pagy_bootstrap_nav(@pagy) %></div>
  <% end %>
</div>
